{% extends "base.html" %}
{% load static %}

{% block content %}
<h3 class="mb-3">{{ titulo }}</h3>

<form method="post" class="card p-4">
  {% csrf_token %}

  {# === DADOS PESSOAIS === #}
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Nome completo</label>
      {{ form.nome_completo }}
      {% if form.nome_completo.errors %}
        <div class="text-danger small">{{ form.nome_completo.errors }}</div>
      {% endif %}
    </div>

    <div class="col-md-3">
      <label class="form-label">Telefone</label>
      {{ form.telefone }}
    </div>

    <div class="col-md-3">
      <label class="form-label">CPF</label>
      {{ form.cpf }}
    </div>

    <div class="col-md-3">
      <label class="form-label">Documento</label>
      {{ form.doc }}
    </div>

    <div class="col-md-3">
      <label class="form-label">Data de nascimento</label>
      {{ form.data_nascimento }}
      <small class="text-muted">Formato: dd/mm/aaaa</small>
    </div>

    <div class="col-md-3">
      <label class="form-label">CEP</label>
      {{ form.cep }}
    </div>

    <div class="col-md-6">
      <label class="form-label">Logradouro</label>
      {{ form.logradouro }}
    </div>

    <div class="col-md-2">
      <label class="form-label">Número</label>
      {{ form.numero }}
    </div>

    <div class="col-md-4">
      <label class="form-label">Complemento</label>
      {{ form.complemento }}
    </div>

    <div class="col-md-4">
      <label class="form-label">Bairro</label>
      {{ form.bairro }}
    </div>

    <div class="col-md-4">
      <label class="form-label">Cidade</label>
      {{ form.cidade }}
    </div>

    <div class="col-md-2">
      <label class="form-label">UF</label>
      {{ form.uf }}
    </div>

    {# === SEÇÃO NOVA: COMISSIONAMENTO === #}
    <div class="col-12 mt-4">
      <h5 class="text-primary border-bottom pb-2">
        <i class="bi bi-cash-coin me-2"></i>Configuração de Comissionamento
      </h5>
    </div>

    <div class="col-md-8">
      <label class="form-label">Parceiro / Comissionado Padrão</label>
      {{ form.parceiro_padrao }}
      <div class="form-text">Quem receberá comissão automaticamente pelos contratos deste cliente.</div>
    </div>

    <div class="col-md-4">
      <label class="form-label">% Comissão Padrão</label>
      <div class="input-group">
        {{ form.percentual_comissao_padrao }}
        <span class="input-group-text">%</span>
      </div>
    </div>
    {# =================================== #}

  </div>

  <div class="d-flex gap-2 mt-4">
    <button type="submit" class="btn btn-success">Salvar</button>
    
    <a href="{% url 'clientes:cliente_list' %}" class="btn btn-secondary">Cancelar</a>
  </div>
</form>

{# =========================
   SCRIPTS
   ========================= #}

<script src="{% static 'js/masks.js' %}"></script>
<script src="{% static 'js/cep_fill.js' %}"></script>

<script>
/* ===============================
   DATA NASCIMENTO dd/mm/aaaa
   =============================== */
(function(){
  const el = document.getElementById("id_data_nascimento");
  if(!el) return;

  el.addEventListener("input", function(){
    let v = el.value.replace(/\D/g, "");

    if (v.length >= 3) v = v.slice(0,2) + "/" + v.slice(2);
    if (v.length >= 6) v = v.slice(0,5) + "/" + v.slice(5,9);

    el.value = v.slice(0,10);
  });

  el.addEventListener("keypress", function(e){
    const ch = String.fromCharCode(e.which);
    if (!/[0-9]/.test(ch)) e.preventDefault();
  });
})();
</script>

{% endblock %}